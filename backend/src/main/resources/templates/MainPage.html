<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Automatic Travel Planning Maker</title>
    </head>
    <body>
        <header>
            <h1>Automatic Travel Planning Maker</h1>
            <h2>Yuyang Tian, Yue Ren Zhang, Tianhong Zhou</h2>
        </header>
    </body>
    <label>Country:</label>
    <div class="tabledropdown">
        <select class="tabledropselection" id="table" onchange="updateAttributes()">
            <option></option>
            <option>UK</option>
        </select>
    </div>
    <br>
    <label>City:</label>
    <br>
    <div id="checkboxes"></div>
    <br>
    <label>Only dates within in 7 days will consider forecasts.<br>All other dates will assume to be always sunny.</label>
    <br>
    <label>Start date:</label>
    <input type="date" id="startDate" name="dateInput">
    <br>
    <label>Leave date:</label>
    <input type="date" id="leaveDate" name="dateInput">
    <br>
    <label>Estimated daily travel time: (recommend to be 10 hours)</label>
    <div class="dailydropdown">
        <select class="dailydropselection" id="daily" onchange="updateAttributes()">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>6</option>
            <option>7</option>
            <option>8</option>
            <option>9</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
        </select>
    </div>
    <form id="formSubmit" action="/templates/MainPage.html" method="POST">
        <input type="hidden" name="country" id="countryInput">
        <input type="hidden" name="city" id="cityInput">
        <input type="hidden" name="startDate" id="startDateInput">
        <input type="hidden" name="leaveDate" id="leaveDateInput">
        <input type="hidden" name="daily" id="dailyInput">
    </form>
    <button type="button" id="submit" value="submit" onclick="submit()" onsubmit="return false">Submit</button>
    <br>
    <script>
        function updateAttributes() {
            let table = document.getElementById("table").value;
            let checkboxes = document.getElementById("checkboxes");
            let attributes = getAttributes(table);
            checkboxes.innerHTML = "";

            // render all checkbox for each table
            for (let i = 0; i < attributes.length; i++) {
                let attribute = attributes[i];
                let checkbox = document.createElement("input");
                checkbox.type = "radio";
                checkbox.name = "attribute";
                checkbox.value = attribute;
                let label = document.createElement("label");
                label.appendChild(document.createTextNode(attribute));
                checkboxes.appendChild(checkbox);
                checkboxes.appendChild(label);
                checkboxes.appendChild(document.createElement("br"));
            }
        }

        function getAttributes(table) {
            // return an array of attribute names for the selected table
            switch (table) {
                case "UK":
                    return ["London"];
                default:
                    return [];
            }
        }

        function submit() {
            let country = document.getElementById("table");
            let startDate = document.getElementById("startDate");
            let leaveDate = document.getElementById("leaveDate");
            let dailyTime = document.getElementById("daily");

            // get checked attribute
            let result = "";
            let radios = document.getElementsByName("attribute");

            if (country.value === "") {
                alert("You have to choose a country");
                return;
            }

            for (let i = 0; i < radios.length; i++) {
                if (radios[i].checked) {
                    result = radios[i].value;
                    break;
                }
            }
            if (result === "") {
                alert("You have to choose a city");
                return;
            }

            if (startDate.value === "" || leaveDate.value === "") {
                alert("You have to choose dates");
                return;
            }

            let date1 = new Date(startDate.value);
            let date2 = new Date(leaveDate.value);
            if (date1 > date2) {
                alert("Start date must before leave date");
                return;
            }

            let form = document.getElementById("formSubmit");
            form.action = "";
            form.method = "POST";
            document.getElementById("countryInput").value = country.value;
            document.getElementById("cityInput").value = result;
            document.getElementById("startDateInput").value = startDate.value;
            document.getElementById("leaveDateInput").value = leaveDate.value;
            document.getElementById("dailyInput").value = dailyTime.value;

            // send post request
            let xhr = new XMLHttpRequest();
            xhr.open(form.method, form.action);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    let responseJson = JSON.parse(xhr.responseText);
                    console.log(responseJson);
                } else {
                    console.error('请求失败: ' + xhr.status);
                }
            };
            // xhr.onerror = function () {
            //     alert(xhr.responseText);
            // };
            let formData = new FormData(form);
            xhr.send(formData);
        }
    </script>
</html>