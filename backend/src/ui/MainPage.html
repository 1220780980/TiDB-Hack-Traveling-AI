<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Automatic Travel Planning Maker</title>
    </head>
    <body>
        <header>
            <h1>Automatic Travel Planning Maker</h1>
            <h2>Yuyang Tian, Yue Ren Zhang, Tianhong Zhou</h2>
        </header>
    </body>
    <label>Country:</label>
    <div class="tabledropdown">
        <select class="tabledropselection" id="table" onchange="updateAttributes()">
            <option></option>
            <option>UK</option>
        </select>
    </div>
    <br>
    <label>City:</label>
    <br>
    <div id="checkboxes"></div>
    <br>
    <label for="dateInput">Start date:</label>
    <input type="date" id="startDate" name="dateInput">
    <br>
    <label for="dateInput">Leave date:</label>
    <input type="date" id="leaveDate" name="dateInput">
    <form id="formSubmit" action="" method="POST">
        <input type="hidden" name="country" id="countryInput">
        <input type="hidden" name="city" id="cityInput">
        <input type="hidden" name="startDate" id="startDateInput">
        <input type="hidden" name="leaveDate" id="leaveDateInput">
    </form>
    <button type="button" id="submit" value="submit" onclick="submit()" onsubmit="return false">Submit</button>
    <br>
    <script>
        function updateAttributes() {
            let table = document.getElementById("table").value;
            let checkboxes = document.getElementById("checkboxes");
            let attributes = getAttributes(table);
            checkboxes.innerHTML = "";

            // render all checkbox for each table
            for (let i = 0; i < attributes.length; i++) {
                let attribute = attributes[i];
                let checkbox = document.createElement("input");
                checkbox.type = "radio";
                checkbox.name = "attribute";
                checkbox.value = attribute;
                let label = document.createElement("label");
                label.appendChild(document.createTextNode(attribute));
                checkboxes.appendChild(checkbox);
                checkboxes.appendChild(label);
                checkboxes.appendChild(document.createElement("br"));
            }
        }

        function getAttributes(table) {
            // return an array of attribute names for the selected table
            switch (table) {
                case "UK":
                    return ["London"];
                default:
                    return [];
            }
        }

        function submit() {
            let country = document.getElementById("table");
            let startDate = document.getElementById("startDate");
            let leaveDate = document.getElementById("leaveDate");

            // get checked attribute
            let result = "";
            let radios = document.getElementsByName("attribute");

            if (country.value === "") {
                alert("You have to choose a country");
                return;
            }

            for (let i = 0; i < radios.length; i++) {
                if (radios[i].checked) {
                    result = radios[i].value;
                    break;
                }
            }
            if (result === "") {
                alert("You have to choose a city");
                return;
            }

            if (startDate.value === "" || leaveDate.value === "") {
                alert("You have to choose dates");
                return;
            }

            let date1 = new Date(startDate.value);
            let date2 = new Date(leaveDate.value);
            if (date1 > date2) {
                alert("Start date must before leave date");
                return;
            }

            let form = document.getElementById("formSubmit");
            form.action = "";
            form.method = "POST";
            document.getElementById("countryInput").value = country.value;
            document.getElementById("cityInput").value = result;
            document.getElementById("startDateInput").value = startDate.value;
            document.getElementById("leaveDateInput").value = leaveDate.value;

            // send post request
            let xhr = new XMLHttpRequest();
            xhr.open(form.method, form.action);
            xhr.onload = function () {

            };
            let formData = new FormData(form);
            xhr.send(formData);
        }
    </script>
</html>